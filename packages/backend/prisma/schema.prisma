generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           String   @id @default(cuid())
  email        String   @unique
  name         String?
  passwordHash String
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  // Relations
  memberships HouseholdMember[]
  addedItems  Item[]

  @@map("users")
}

model Household {
  id         String   @id @default(cuid())
  name       String
  inviteCode String   @unique @default(cuid())
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  // Relations
  members     HouseholdMember[]
  items       Item[]
  suggestions Suggestion[]
  history     PurchaseHistory[]

  @@map("households")
}

model HouseholdMember {
  id          String   @id @default(cuid())
  role        Role     @default(MEMBER)
  joinedAt    DateTime @default(now())
  userId      String
  householdId String

  // Relations
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  household Household @relation(fields: [householdId], references: [id], onDelete: Cascade)

  @@unique([userId, householdId])
  @@index([userId])
  @@index([householdId])
  @@map("household_members")
}

model Item {
  id          String    @id @default(cuid())
  name        String
  quantity    String?
  category    Category  @default(UNCATEGORIZED)
  isChecked   Boolean   @default(false)
  checkedAt   DateTime?
  checkedBy   String?
  notes       String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  householdId String
  addedById   String

  // Relations
  household Household @relation(fields: [householdId], references: [id], onDelete: Cascade)
  addedBy   User      @relation(fields: [addedById], references: [id])

  @@index([householdId, isChecked])
  @@index([householdId, createdAt])
  @@map("items")
}

model Suggestion {
  id          String    @id @default(cuid())
  itemName    String
  category    Category
  confidence  Float // 0.0 to 1.0
  reason      String
  createdAt   DateTime  @default(now())
  acceptedAt  DateTime?
  rejectedAt  DateTime?
  householdId String

  // Relations
  household Household @relation(fields: [householdId], references: [id], onDelete: Cascade)

  @@index([householdId, createdAt])
  @@map("suggestions")
}

model PurchaseHistory {
  id          String   @id @default(cuid())
  itemName    String
  category    Category
  purchasedAt DateTime @default(now())
  purchasedBy String
  householdId String

  // Relations
  household Household @relation(fields: [householdId], references: [id], onDelete: Cascade)

  @@index([householdId, itemName, purchasedAt])
  @@index([householdId, purchasedAt])
  @@map("purchase_history")
}

enum Role {
  ADMIN
  MEMBER
  VIEWER
}

enum Category {
  PRODUCE
  DAIRY
  MEAT
  BAKERY
  PANTRY
  FROZEN
  BEVERAGES
  SNACKS
  HOUSEHOLD
  PERSONAL_CARE
  BABY
  PET
  OTHER
  UNCATEGORIZED
}
